import n,{useRef as t,useEffect as e,createContext as r,useContext as o,forwardRef as u,useImperativeHandle as c,useState as a,useCallback as i,useMemo as l}from"react";import{createPortal as s}from"react-dom";import{DomUtil as f,LatLngBounds as p,Control as d,Circle as y,CircleMarker as m,FeatureGroup as v,GeoJSON as b,ImageOverlay as w,LayerGroup as h,Map as g,Marker as C,Polygon as L,Polyline as O,Popup as x,Rectangle as P,SVGOverlay as I,TileLayer as z,Tooltip as E,VideoOverlay as k}from"leaflet";function _(n,r){const o=t(r);e((function(){r!==o.current&&null!=n.attributionControl&&(null!=o.current&&n.attributionControl.removeAttribution(o.current),null!=r&&n.attributionControl.addAttribution(r)),o.current=r}),[n,r])}function N(n,t,e){t.center!==e.center&&n.setLatLng(t.center),null!=t.radius&&t.radius!==e.radius&&n.setRadius(t.radius)}const S=1;function B(n,t){return Object.freeze({...n,...t})}const A=r(null),R=A.Provider;function j(){const n=o(A);if(null==n)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function T(t){return u((function(e,r){const{instance:o,context:u}=t(e).current;return c(r,(()=>o)),null==e.children?null:n.createElement(R,{value:u},e.children)}))}function G(n){return u((function(t,e){const{instance:r}=n(t).current;return c(e,(()=>r)),null}))}function H(n){return function(r){const o=j(),u=n(r,o),{instance:c}=u.current,a=t(r.position),{position:i}=r;return e((function(){return c.addTo(o.map),function(){c.remove()}}),[o.map,c]),e((function(){null!=i&&i!==a.current&&(c.setPosition(i),a.current=i)}),[c,i]),u}}function M(n,r){const o=t();e((function(){return null!=r&&n.instance.on(r),o.current=r,function(){null!=o.current&&n.instance.off(o.current),o.current=null}}),[n,r])}function Z(n,t){const e=n.pane??t.pane;return e?{...n,pane:e}:n}function U(n,t){(function(n){return n.split(" ").filter(Boolean)})(t).forEach((t=>{f.addClass(n,t)}))}function V(n,t,e){return Object.freeze({instance:n,context:t,container:e})}function $(n,r){return null==r?function(e,r){const o=t();return o.current||(o.current=n(e,r)),o}:function(o,u){const c=t();c.current||(c.current=n(o,u));const a=t(o),{instance:i}=c.current;return e((function(){a.current!==o&&(r(i,o,a.current),a.current=o)}),[i,o,u]),c}}function q(n,t){e((function(){return(t.layerContainer??t.map).addLayer(n.instance),function(){t.layerContainer?.removeLayer(n.instance),t.map.removeLayer(n.instance)}}),[t,n])}function F(n){return function(t){const e=j(),r=n(Z(t,e),e);return _(e.map,t.attribution),M(r.current,t.eventHandlers),q(r.current,e),r}}function J(n){return function(r){const o=j(),u=n(Z(r,o),o);return M(u.current,r.eventHandlers),q(u.current,o),function(n,r){const o=t();e((function(){if(r.pathOptions!==o.current){const t=r.pathOptions??{};n.instance.setStyle(t),o.current=t}}),[n,r])}(u.current,r),u}}function W(n){return G(H($((function(t,e){return V(n(t),e)}))))}function Y(n,t){return T(F($(n,t)))}function D(n,t){const r=function(n,t){return function(e,r){const o=j(),u=n(Z(e,o),o);return _(o.map,e.attribution),M(u.current,e.eventHandlers),t(u.current,o,e,r),u}}($(n),t);return function(n){return u((function(t,r){const[o,u]=a(!1),{instance:i}=n(t,u).current;c(r,(()=>i)),e((function(){o&&i.update()}),[i,o,t.children]);const l=i._contentNode;return l?s(t.children,l):null}))}(r)}function K(n,t){return T(J($(n,t)))}function Q(n,t){return G(F($(n,t)))}function X(n,t,e){const{opacity:r,zIndex:o}=t;null!=r&&r!==e.opacity&&n.setOpacity(r),null!=o&&o!==e.zIndex&&n.setZIndex(o)}function nn(n,t,e){t.bounds instanceof p&&t.bounds!==e.bounds&&n.setBounds(t.bounds),null!=t.opacity&&t.opacity!==e.opacity&&n.setOpacity(t.opacity),null!=t.zIndex&&t.zIndex!==e.zIndex&&n.setZIndex(t.zIndex)}function tn(){return j().map}function en(n,t){const r=tn();return e((function(){return r.on(n,t),function(){r.off(n,t)}}),[r,n,t]),r}function rn(n){const t=tn();return e((function(){return t.on(n),function(){t.off(n)}}),[t,n]),t}const on=W((function(n){return new d.Attribution(n)})),un=K((function({center:n,children:t,...e},r){const o=new y(n,e);return V(o,B(r,{overlayContainer:o}))}),N),cn=K((function({center:n,children:t,...e},r){const o=new m(n,e);return V(o,B(r,{overlayContainer:o}))}),N),an=K((function({children:n,...t},e){const r=new v([],t);return V(r,B(e,{layerContainer:r,overlayContainer:r}))})),ln=K((function({data:n,...t},e){const r=new b(n,t);return V(r,B(e,{overlayContainer:r}))}),(function(n,t,e){t.style!==e.style&&(null==t.style?n.resetStyle():n.setStyle(t.style))})),sn=Y((function({bounds:n,url:t,...e},r){const o=new w(t,n,e);return V(o,B(r,{overlayContainer:o}))}),(function(n,t,e){if(nn(n,t,e),t.bounds!==e.bounds){const e=t.bounds instanceof p?t.bounds:new p(t.bounds);n.setBounds(e)}t.url!==e.url&&n.setUrl(t.url)})),fn=Y((function({children:n,...t},e){const r=new h([],t);return V(r,B(e,{layerContainer:r}))})),pn=T(H($((function({children:n,...t},e){const r=new d.Layers(void 0,void 0,t);return V(r,B(e,{layersControl:r}))}),(function(n,t,e){t.collapsed!==e.collapsed&&(!0===t.collapsed?n.collapse():n.expand())}))));function dn(r){return function(o){const u=j(),c=t(o),[s,f]=a(null),{layersControl:p,map:d}=u,y=i((n=>{null!=p&&(c.current.checked&&d.addLayer(n),r(p,n,c.current.name),f(n))}),[p,d]),m=i((n=>{p?.removeLayer(n),f(null)}),[p]),v=l((()=>B(u,{layerContainer:{addLayer:y,removeLayer:m}})),[u,y,m]);return e((()=>{null!==s&&c.current!==o&&(!0!==o.checked||null!=c.current.checked&&!1!==c.current.checked?!0!==c.current.checked||null!=o.checked&&!1!==o.checked||d.removeLayer(s):d.addLayer(s),c.current=o)})),o.children?n.createElement(R,{value:v},o.children):null}}pn.BaseLayer=dn((function(n,t,e){n.addBaseLayer(t,e)})),pn.Overlay=dn((function(n,t,e){n.addOverlay(t,e)}));const yn=u((function({bounds:t,boundsOptions:r,center:o,children:u,className:l,id:s,placeholder:f,style:p,whenReady:d,zoom:y,...m},v){const[b]=a({className:l,id:s,style:p}),[w,h]=a(null);c(v,(()=>w?.map??null),[w]);const C=i((n=>{if(null!==n&&null===w){const e=new g(n,m);null!=o&&null!=y?e.setView(o,y):null!=t&&e.fitBounds(t,r),null!=d&&e.whenReady(d),h(function(n){return Object.freeze({__version:S,map:n})}(e))}}),[]);e((()=>()=>{w?.map.remove()}),[w]);const L=w?n.createElement(R,{value:w},u):f??null;return n.createElement("div",{...b,ref:C},L)})),mn=Y((function({position:n,...t},e){const r=new C(n,t);return V(r,B(e,{overlayContainer:r}))}),(function(n,t,e){t.position!==e.position&&n.setLatLng(t.position),null!=t.icon&&t.icon!==e.icon&&n.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==e.zIndexOffset&&n.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==e.opacity&&n.setOpacity(t.opacity),null!=n.dragging&&t.draggable!==e.draggable&&(!0===t.draggable?n.dragging.enable():n.dragging.disable())})),vn=["mapPane","markerPane","overlayPane","popupPane","shadowPane","tilePane","tooltipPane"];function bn(n,t){const{[t]:e,...r}=n;return r}const wn=u((function(t,r){const[o]=a(t.name),[u,i]=a(null);c(r,(()=>u),[u]);const f=j(),p=l((()=>({...f,pane:o})),[f]);return e((()=>(i(function(n,t,e){if(-1!==vn.indexOf(n))throw new Error(`You must use a unique name for a pane that is not a default Leaflet pane: ${n}`);if(null!=e.map.getPane(n))throw new Error(`A pane with this name already exists: ${n}`);const r=t.pane??e.pane,o=r?e.map.getPane(r):void 0,u=e.map.createPane(n,o);return null!=t.className&&U(u,t.className),null!=t.style&&Object.keys(t.style).forEach((n=>{u.style[n]=t.style[n]})),u}(o,t,f)),function(){const n=f.map.getPane(o);n?.remove?.(),null!=f.map._panes&&(f.map._panes=bn(f.map._panes,o),f.map._paneRenderers=bn(f.map._paneRenderers,o))})),[]),null!=t.children&&null!=u?s(n.createElement(R,{value:p},t.children),u):null})),hn=K((function({positions:n,...t},e){const r=new L(n,t);return V(r,B(e,{overlayContainer:r}))}),(function(n,t,e){t.positions!==e.positions&&n.setLatLngs(t.positions)})),gn=K((function({positions:n,...t},e){const r=new O(n,t);return V(r,B(e,{overlayContainer:r}))}),(function(n,t,e){t.positions!==e.positions&&n.setLatLngs(t.positions)})),Cn=D((function(n,t){return V(new x(n,t.overlayContainer),t)}),(function(n,t,{position:r},o){e((function(){const{instance:e}=n;function u(n){n.popup===e&&(e.update(),o(!0))}function c(n){n.popup===e&&o(!1)}return t.map.on({popupopen:u,popupclose:c}),null==t.overlayContainer?(null!=r&&e.setLatLng(r),e.openOn(t.map)):t.overlayContainer.bindPopup(e),function(){t.map.off({popupopen:u,popupclose:c}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(e)}}),[n,t,o,r])})),Ln=K((function({bounds:n,...t},e){const r=new P(n,t);return V(r,B(e,{overlayContainer:r}))}),(function(n,t,e){t.bounds!==e.bounds&&n.setBounds(t.bounds)})),On=W((function(n){return new d.Scale(n)})),xn=F($((function(n,t){const{attributes:e,bounds:r,...o}=n,u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("xmlns","http://www.w3.org/2000/svg"),null!=e&&Object.keys(e).forEach((n=>{u.setAttribute(n,e[n])}));return V(new I(u,r,o),t,u)}),nn));const Pn=u((function({children:n,...t},e){const{instance:r,container:o}=xn(t).current;return c(e,(()=>r)),null==o||null==n?null:s(n,o)})),In=Q((function({url:n,...t},e){return V(new z(n,Z(t,e)),e)}),(function(n,t,e){X(n,t,e);const{url:r}=t;null!=r&&r!==e.url&&n.setUrl(r)})),zn=D((function(n,t){return V(new E(n,t.overlayContainer),t)}),(function(n,t,{position:r},o){e((function(){const e=t.overlayContainer;if(null==e)return;const{instance:u}=n,c=n=>{n.tooltip===u&&(null!=r&&u.setLatLng(r),u.update(),o(!0))},a=n=>{n.tooltip===u&&o(!1)};return e.on({tooltipopen:c,tooltipclose:a}),e.bindTooltip(u),function(){e.off({tooltipopen:c,tooltipclose:a}),null!=e._map&&e.unbindTooltip()}}),[n,t,o,r])})),En=Y((function({bounds:n,url:t,...e},r){const o=new k(t,n,e);return!0===e.play&&o.getElement()?.play(),V(o,B(r,{overlayContainer:o}))}),(function(n,t,e){nn(n,t,e),"string"==typeof t.url&&t.url!==e.url&&n.setUrl(t.url);const r=n.getElement();null!=r&&(!0!==t.play||e.play?t.play||!0!==e.play||r.pause():r.play())})),kn=Q((function({eventHandlers:n,params:t={},url:e,...r},o){return V(new z.WMS(e,{...t,...Z(r,o)}),o)}),(function(n,t,e){X(n,t,e),null!=t.params&&t.params!==e.params&&n.setParams(t.params)})),_n=W((function(n){return new d.Zoom(n)}));export{on as AttributionControl,un as Circle,cn as CircleMarker,an as FeatureGroup,ln as GeoJSON,sn as ImageOverlay,fn as LayerGroup,pn as LayersControl,yn as MapContainer,mn as Marker,wn as Pane,hn as Polygon,gn as Polyline,Cn as Popup,Ln as Rectangle,Pn as SVGOverlay,On as ScaleControl,In as TileLayer,zn as Tooltip,En as VideoOverlay,kn as WMSTileLayer,_n as ZoomControl,tn as useMap,en as useMapEvent,rn as useMapEvents};
